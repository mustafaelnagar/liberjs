/**
 * @author soyoes 
 * @Copywrite (c) 2013, Liberhood, http://liberhood.com 
 * @URL : https://github.com/soyoes/liberjs
 * @license : MIT License
 */

function $(e,t,n){var r;if(n==undefined)n=$conf.query_all_layer==undefined?true:$conf.query_all_layer;if(n&&e.indexOf(" ")<0){if(e.charAt(0)=="#")return document.getElementById(e.replace("#",""));r=document.querySelectorAll(e)}else{e=!n?"#"+$this.id+" "+e:e;var i=e.trim().split(" ");var s=i[i.length-1];r=document.querySelectorAll(e);if(s.charAt(0)=="#")return r[0]}if(t&&r)r.each(t);return r}function $id(e,t){if(t==undefined)t=$conf.query_all_layer?true:false;return t?document.getElementById(e):$("#"+e,null,t)}var __packages="",$this,$conf=$conf||{},__layerIDX=0,__layers=[],__args=null,__runtimeIdx=0,__={},__set=function(e,t,n){__[e]=t;n=n||300;$.setTimeout(function(e){delete __[e]},n,e)},__clear=function(){__={}},__eventMatchers={HTMLEvents:/^(?:load|unload|abort|error|select|change|submit|reset|focus|blur|resize|scroll)$/,MouseEvents:/^(?:click|dblclick|mouse(?:down|up|over|move|out))$/},__eventDefaultOptions={pointerX:0,pointerY:0,button:0,ctrlKey:false,altKey:false,shiftKey:false,metaKey:false,bubbles:true,cancelable:true},stopPropagation=function(e){e=e||window.event;if(e.stopPropagation)e.stopPropagation();e.cancelBubble=false},preventDefault=function(e){e=e||window.event;if(e.preventDefault)e.preventDefault();e.returnValue=false},$browser=function(){var e=navigator.appName,t=navigator.userAgent,n;var r=t.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);if(r&&(n=t.match(/version\/([\.\d]+)/i))!=null)r[2]=n[1];r=r?[r[1],r[2]]:[e,navigator.appVersion,0];var i=t.match(/(iPhone|iPod|Android)/i);var s={name:r[0],version:parseInt(r[1]),device:i?"smartphone":"pc"};var o=navigator.appVersion;var u={Win:"windows",Mac:"mac",X11:"linux",Linux:"linux"};for(var a in u){if(o.indexOf(a)>=0){s.os=u[a];break}}if(s.name=="MSIE"&&t.indexOf("Trident/5.0")>0){s.version=9;if($conf.redirect_ie9)location.href=$conf.redirect_ie9}if(!window.console){var f=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],l=function(){},c=f.length,h=window.console=window.console||{};for(var p=0;p<c;p++){if(!h[f[p]]){h[f[p]]=l}}}return s}();$.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"};$.isFunc=function(e){var t={};return e&&t.toString.call(e)==="[object Function]"};$.isBool=function(e){return e===true||e===false};$.isElement=function(e){try{return e instanceof HTMLElement||e instanceof SVGElement}catch(t){return typeof e==="object"&&e.nodeType===1&&typeof e.style==="object"&&typeof e.ownerDocument==="object"}};$.isNumber=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};$.keys=function(e){var t=[];for(var n in e){t.push(n)}return t};$.values=function(e){var t=[];for(var n in e){t.push(e[n])}return t};$.firstKey=function(e){for(var t in e)return t};$.unique=function(e){var t=[];for(var n in e){if(t.indexOf(e[n])<0)t.push(e[n])}return t};$.trim=function(e,t){var n=[];for(var r=0;r<e.length;r++){var i=e[r];if(t){if(t(i))n.push(i)}else if(i===0||i!=null&&i!=undefined&&i!="")n.push(i)}return n};$.range=function(e,t){if(!e)return false;var n,r,i,s;for(s=0;s<e.length;s++){i=t?e[s][t]:e[s];if(!n){n=i;r=i}if(n>i)n=i;if(r<i)r=i}return[n,r]};$.sort=function(e,t){if(!e)return false;return e.sort(function(e,n){if(!t)return n>e?-1:n==e?0:1;else return n[t]>e[t]?-1:n[t]==e[t]?0:1})};$.getArguments=function(){if(__args)return __args;var e=document.getElementsByTagName("script");__args={};for(var t in e){var n=e[t];if(n.src.indexOf("liber.js")>=0){var r=n.src.split("liber.js");var i=r[1];if(i.indexOf("?")==0){i=i.replace("?","");r=i.split("&");for(var s in r){var o=r[s].split("=");__args[o[0]]=o[1]}}return __args}}};$.getCookie=function(e){if(document.cookie){var t=$.unserialize(document.cookie,";");return t[e]}return null};$.unserialize=function(e,t,n){if(!e)return null;t=t||"&";n=n||"=";e=e.replace(/(.*)\?/i,"");var r=e.split(t);var i={};for(var s in r){var o=r[s].split(n);if(o.length==2)i[o[0].trim()]=o[1]}return i};$.serialize=function(e,t,n){var r=[];t=t||"&";n=n||"=";for(var i in e){r.push([i,e[i]].join(n))}return r.join(t)};$.serializeForm=function(e){var t={};var n=e.querySelectorAll("input, select, textarea");for(var r=0;r<n.length;++r){var i=n[r];var s=i.name;var o=i.value;if((i.type=="checkbox"||i.type=="radio")&&!i.checked)continue;if(s){if(t[s]){if(!$.isArray(t[s]))t[s]=[t[s]];t[s].push(o)}else t[s]=o}}return t};$.preload=function(e,t,n){for(var r=0;r<e.length;r++){var i=e[r];if(i.indexOf("http")!=0&&$conf.preload_image_path){if(i.indexOf($conf.preload_image_path)!=0){i=$conf.preload_image_path+i}}var s=new Image;if(t)s.onload=function(e){e=e||window.event;var n=e.target||e.srcElement;t(n.src)};if(n)s.onerror=function(e){e=e||window.event;n(e.target||e.srcElement)};s.src=i}};$.setTimeout=function(e,t,n){if($browser.name=="Firefox"){var r=e;setTimeout(r,t,n)}else if($browser.name=="MSIE"){setTimeout(function(t){return function(){e(t)}}(n),t)}else setTimeout(e,t,n)};$.keyCode=function(e){if(document.all)return e.keyCode;else if($id)return e.keyCode?e.keyCode:e.charCode;else if(document.layers)return e.which};$.empty=function(e){if(!e)return true;if(e.length&&e.length==0)return false;if(typeof e==="object"){for(var t in e){return false}return true}return false};$.clone=function(e){if(typeof e=="object"){var t={};for(var n in e)t[n]=e[n];return t}else if($.isArray(e)){return e.slice(0)}return e};$.include=function(e,t,n){if(e.indexOf(".js")<0)e+=".js";if(e.indexOf("/")<0)e=$conf.liber_path+e;var r=e.split("/");r=r[r.length-1].replace(/\./g,"_");var i=(new Date).getTime();if(!$id(r,true)){var s=t;var o=n;var u=function(e){if(!$app.__included)$app.__included=[];e=e||window.event;var t=e.target||e.srcElement;if(t.readyState=="loading")return;if(e.type=="error"){}t.onload=t.onreadystatechange=null;$app.__included.push(t.id);if(s)s(o)};var a=document.createElement("script");a.id=r;a.type="text/javascript";a.onload=a.onreadystatechange=u;a.onerror=u;var f=document.head?document.head:document.getElementsByTagName("head")[0];if(document.head){f.appendChild(a);a.src=e.indexOf("liber.")>=0?e+"?v="+i:e}else{a.src=e.indexOf("liber.")>=0?e+"?v="+i:e;f.appendChild(a)}}else{if(t){if(typeof t=="function")t(n);else if(typeof t=="string"){t=window[t];if(t)t(n)}}}};$.archivePath=function(e,t){var n=parseInt(e)%parseInt(t);return[n,e].join("/")};$.extend=function(e,t){for(var n in t)if(!(n in e))e[n]=t[n];return e};$.fire=function(e,t){e=typeof e=="string"?$id(e):e;if(e==undefined)return;var n=$.extend(__eventDefaultOptions,arguments[2]||{});oEvent=null,eventType=null;for(var r in __eventMatchers){if(__eventMatchers[r].test(t)){eventType=r;break}}if(!eventType)throw new SyntaxError("Only HTMLEvents and MouseEvents interfaces are supported");if(e[t]){e[t]()}else if(document.createEvent){oEvent=document.createEvent(eventType);if(eventType=="HTMLEvents"){oEvent.initEvent(t,n.bubbles,n.cancelable)}else{oEvent.initMouseEvent(t,n.bubbles,n.cancelable,document.defaultView,n.button,n.pointerX,n.pointerY,n.pointerX,n.pointerY,n.ctrlKey,n.altKey,n.shiftKey,n.metaKey,n.button,e)}e.dispatchEvent(oEvent)}else{n.clientX=n.pointerX;n.clientY=n.pointerY;var i=document.createEventObject();oEvent=$.extend(i,n);e.fireEvent("on"+t,oEvent)}return e};$.log=function(e){if(!$conf.log_url)return;var t=$app.userId||"0";e=[$this.name,t,e].join(":");if($http)$http.get([log_url+"?action=",e].join(""))};$.rand=function(e,t){var n=arguments.length;if(n===0){e=0;t=2147483647}else if(n===1){t=e;e=1}return Math.floor(Math.random()*(t-e+1))+e};var $html={entityMap:{escape:{"&":"&","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},unescape:{"&":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#x27;":"'"}},escape:function(e){if(e===null||e===undefined)return"";var t=this;var n=new RegExp("["+$.keys(t.entityMap.escape).join("")+"]","g");return(""+e).replace(n,function(e){return t.entityMap.escape[e]})},unescape:function(e){if(e===null||e===undefined)return"";var t=this;var n=new RegExp("("+$.keys(t.entityMap.unescape).join("|")+")","g");return(""+e).replace(n,function(e){return t.entityMap.unescape[e]})}};var $app={start:function(e){var t={modules:[],liber_path:"/js/"};$app.start_view=e;for(var n in t){if(!$conf[n])$conf[n]=t[n]}var r=$conf.layout?$conf.layout:$browser.device=="smartphone"?"grids":"overlay";$conf.modules.push("liber.layout."+r);var i=$conf.preload_images?$conf.preload_images:[];var s=$conf.modules.length+i.length,o=0;var u=function(){o++;var e=parseInt(o*100/s);if($app.progressBar&&$app.progressBar.update)$app.progressBar.update(e);if(e>=100){$app.preloaded()}};for(var n in $conf.modules){$.include($conf.modules[n],u,$conf.modules[n])}if(i.length>0){$.preload(i,u,u)}},preloaded:function(){if($app.layout)$app.layout.init(document.body,$app,$conf.layout_options||{});if($app.onload)$app.onload();else{$app.loaded()}},loaded:function(){var e=typeof $app.start_view=="string"?$app.start_view:$conf.default_view;$app.loadView(e,true)},handle:function(e,t){switch(e){case"loaded":$app.drawView();break;case"redirect":$app.loadView(t,true);break;default:break}},trans:function(e){e=e||window.event;var t=e.target||e.srcElement;if(t){var n=t.getAttribute("url");if(n){$app.loadView(n,t.tagName!="a")}}},loadView:function(e,t){e=e||$conf.default_view;if(e){if(e.indexOf("http:")==0||e.indexOf("https:")==0){location.href=e;return}else{var n=$.unserialize(e);var r=e.split("?")[0];$app.view=r;var i=$controller.enhance(r);if(!i){throw new Error("100 : "+r+" does not exist");return}$this=i;var s=location.href.toString();if(t&&s.indexOf("#"+e,s.length-e.length-1)!==-1)$history.push(e);i.params=n;if(i.onload){i.onload(n)}else{i.loaded()}}}},drawView:function(e){e=e||$app.view;e=typeof e=="string"?window[e]:e;if(!e){$app.closeView($app.view);return}$app.layout.drawView(e)},closeView:function(e){e=e||$this;if(typeof e=="string")e=window[e];if(!e)return;$app.view=undefined;if($history.views.length>1){$history.views.pop()}var t=$history.views.length>1?$history.views.pop():$history.views[0];$app.view=t;$this=window[t];if(e.onclose)e.onclose();$app.layout.closeView(e)}};var $controller={loaded:function(){$app.handle("loaded")},close:function(){$app.closeView($this)},redirect:function(e){$app.handle("redirect",e)},enhance:function(e){var t;if(typeof e=="string"){t=e;e=window[t]}if(!e){throw new Error("101 :no view to enhance");return}else{e.name=e.name||t}if(!e.__enhanced){$.extend(e,$controller);delete e["enhance"];e.__enhanced=true}return e}};var $history={views:[],push:function(e){$history.views.push(e.split("?")[0]);$.fire($a({href:"#"+e,html:"_"}),"click")},init:function(){window.onhashchange=function(){var hash=window.location.hash.replace(/^#/,"");if(hash.match(/^~/)){var func=hash.replace(/^~/,"");try{eval(func+"()")}catch(ex){}}else{$app.loadView(hash,false)}}}};$history.init();String.prototype.ucfirst=function(){return this.charAt(0).toUpperCase()+this.substring(1)};String.prototype.toHex=function(){var e=[],t=this.length;for(var n=0;n<t;n+=1){var r=this.charCodeAt(n);e.push(r.toString(16))}return e.join("")};String.prototype.getByte=function(){var e=0;for(var t=0;t<this.length;t++){var n=escape(this.charAt(t));if(n.length<4)e++;else e+=2}return e};String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.CJKLength=function(){var e=0;var t=escape(this);for(var n=0;n<t.length;n++,e++){if(t.charAt(n)=="%"){if(t.charAt(++n)=="u"){n+=3;e++}n++}}return e};String.prototype.splice=function(e,t,n){return this.slice(0,e)+n+this.slice(e+Math.abs(t))};if(typeof String.prototype.startsWith!="function"){String.prototype.startsWith=function(e){return this.slice(0,e.length)==e}}if(typeof String.prototype.endsWith!="function"){String.prototype.endsWith=function(e){return this.slice(-e.length)==e}}NodeList.prototype.each=function(e){if(e)for(var t=0;t<this.length;t++)e(this[t],t);return this};NodeList.prototype.callfunc=function(e,t,n){var r=e&&(typeof e=="string"||e instanceof String)?Element.prototype[e]:false;if(r)for(var i=0;i<this.length;i++)r.call(this[i],t,n);return this};NodeList.prototype.attr=function(e,t){return this.callfunc("attr",e,t)};NodeList.prototype.css=function(e,t){return this.callfunc("css",e,t)};NodeList.prototype.bind=function(e,t){return this.callfunc("bind",e,t)};NodeList.prototype.hide=function(e){return this.callfunc("hide")};NodeList.prototype.show=function(){return this.callfunc("show")};var $deltas={linear:function(e){return e},quad:function(e){return Math.pow(e,2)},quad5:function(e){return Math.pow(e,5)},circ:function(e){return 1-Math.sin(Math.acos(e))},back:function(e,t){t=t||1.5;return Math.pow(e,2)*((t+1)*e-t)},bounce:function(e){for(var t=0,n=1,r;1;t+=n,n/=2){if(e>=(7-4*t)/11){return-Math.pow((11-6*t-11*e)/4,2)+Math.pow(n,2)}}},elastic:function(e,t){t=t||.1;return Math.pow(2,10*(e-1))*Math.cos(20*Math.PI*t/3*e)},easeOut:function(e){if(typeof e=="string")e=$deltas[e];return function(t){return 1-e(1-t)}},easeInOut:function(e){if(typeof e=="string")e=$deltas[e];return function(t){if(t<=.5){return e(2*t)/2}else{return(2-e(2*(1-t)))/2}}}};var __element={addClass:function(e){if(this.className.indexOf(e)<0){this.className+=" "+e}return this},removeClass:function(e){if(!e)return this;e=e.trim();this.className=this.className.replace(new RegExp("\\s+"+e+"\\s+","gm")," ").replace(new RegExp("^"+e+"\\s+","gm"),"").replace(new RegExp("\\s+"+e+"$","gm"),"");return this},css:function(e,t){if(typeof e=="string"){if(t!=undefined){if(e.indexOf("background")>=0&&t.indexOf("url(")>=0&&$conf.image_path&&t.indexOf("data:image")<0&&t.indexOf("http")<0){t=t.replace("url(","url("+$conf.image_path)}this.style[e]=t}else return this.style[e]}else if(typeof e=="object"&&!t){for(var n in e){this.css(n,e[n])}}return this},attr:function(e,t){if(typeof e=="string"){if(e=="var"){__set(t,this);return this}if(e=="id"){this.id=t;__set(t,this);return this}if(e=="html")e="innerHTML";if(e=="class"||e=="classname")e="className";if(e=="url"&&typeof t=="string"){this.bind("click",$app.trans)}if(t!=undefined){if(this.tagName.toUpperCase()=="IMG"&&e.toLowerCase()=="src"){this[e]=$conf.image_path&&t.indexOf("data:image")<0&&t.indexOf("http")!=0?$conf.image_path+t:t}else{this[e]=t}if(typeof t!="function"&&!$.isBool(t)){if(this.tagName=="INPUT"){if($browser.name=="MSIE"&&$browser.version<9&&(e=="type"||e=="name"))return this;if($browser.name=="MSIE"&&$browser.version<10&&e=="placeHolder"){this.setAttribute(e,t);if(!this.value||this.value==""){this.value=t;this.style.color="#999";this.attachEvent("onfocus",function(e){e=e||window.event;var t=event.srcElement;t.style.color="#333";if(t.value==t.attr("placeHolder")){t.value=""}});this.attachEvent("onblur",function(e){e=e||window.event;var t=event.srcElement;if(t.value==""||t.value==t.attr("placeHolder")){t.value=t.attr("placeHolder");t.style.color="#999"}else{t.style.color="#333"}})}}}if(e!="innerHTML"&&e!="className"&&e!="src")this.setAttribute(e,t)}}else{return this.getAttribute(e)}}else if(typeof e=="object"&&!t){for(var n in e){if(typeof e[n]=="function"){this.bind(n,e[n])}else{this.attr(n,e[n])}}}return this},bind:function(e,t){if(typeof e=="string"){if(t){e=e.replace(/^on/,"");if(this.addEventListener)this.addEventListener(e,t,false);else if(this.attachEvent){if(typeof t=="function")this.attachEvent("on"+e,t);else if(typeof t=="string")this.setAttribute("on"+e,t)}else{this["on"+e]=t}}}else if(typeof e=="object"&&!t){for(var n in e){n=n.replace(/^on/,"");if(this.addEventListener)this.addEventListener(n,e[n],false);else if(this.attachEvent){this.attachEvent("on"+n,e[n]);if(typeof e[n]=="function")this.attachEvent("on"+n,e[n]);else if(typeof e[n]=="string")this.setAttribute("on"+n,e[n])}else{this["on"+n]=e[n]}}}return this},height:function(){return $ui.height(this)},width:function(){return $ui.width(this)},hide:function(){$ui.hide(this);return this},show:function(){$ui.show(this);return this},unselectable:function(){$ui.unselectable(this);return this},animate:function(e){var t=this;if(e.delay){var n=parseInt(e.delay);delete e["delay"];$.setTimeout(function(e){if(e.ele)e.ele.animate(e.opts)},n,{ele:t,opts:e});return t}var r=Date.now();e.duration=e.duration||1e3;e.frame=e.frame||60;e.interval=1e3/e.frame;e.delta=e.delta||"linear";var i=setInterval(function(){var n=new Date-r;var s=n/e.duration;if(s>1)s=1;var o=$deltas[e.delta];if(e.style){if(e.style=="easeOut")o=$deltas.easeOut(o);if(e.style=="easeInOut")o=$deltas.easeInOut(o)}var u=o(s);e.step(t,u);if(s==1){clearInterval(i)}},e.interval);return this},hover:function(over,out){if(over){this.attr({__over:"("+over.toString()+")",__exec:"no"});this.bind({mouseover:function(e){e=e||window.event;var t=e.target||e.srcElement;var f=eval(t.attr("__over"));if(f&&"no"===t.attr("__exec")){t.attr("__exec","yes");f(e,t)}else return preventDefault()&&false}})}if(out){this.attr({__out:"("+out.toString()+")"});this.bind({mouseout:function(e){e=e||window.event;var t=e.target||e.srcElement;var rect=$ui.rect(t);if($ui.inRect($ui.cursor(e),rect)){return preventDefault()&&false}else{var out=eval(t.attr("__out"));if(out){t.attr({__exec:"no"});out(e,t)}}}})}return this}};if($browser.name=="MSIE"&&$browser.version<9){$.include("liber.ie8")}else{if(typeof Element.prototype.animate=="function")Element.prototype.animate=__element.animate;$.extend(Element.prototype,__element)}var $e=function(e,t,n,r){e=r?e.replace(/_/g,"-"):e;var i=r?document.createElementNS(r,e):document.createElement(e);if(n&&typeof n=="string")n=$id(n);if(t){var s=typeof t;if(s=="string"){switch(e){case"img":i.src=$conf.image_path&&t.indexOf("data:image")<0&&t.indexOf("http")<0?$conf.image_path+t:t;break;case"a":i.href=t;break;default:i.innerHTML=t;break}}else if($.isArray(t)){for(var o in t){if(t[o]!=null){if($.isElement(t[o])){i.appendChild(t[o])}else if($.isFunc(t[o])){var u=i;var a=t[o]();if($.isArray(a)){for(var f in a){if($.isElement(a[f]))u.appendChild(a[f])}}else if($.isElement(a)){u.appendChild(a)}i=u}else{}}}}else if($.isElement(t)){i.appendChild(t)}else if($.isFunc(t)){return $e(e,t(),n)}else if(s=="object"){for(var l in t){var c=t[l];if(typeof c=="function"){i[l]=c}else{i.attr(l,c)}}}}if(n&&typeof n!="function")n.appendChild(i);return i};var __tags=["div","p","span","br","hr","ul","ol","li","dl","dt","dd","article","section","aside","footer","header","nav","table","caption","tbody","thead","tfoot","colgroup","col","tr","td","th","form","fieldset","legend","input","label","textarea","b","h1","h2","h3","h4","h5","h6","cite","pre","s","u","i","mark","q","small","sub","sup","abbr","bdo","time","em","dfn","code","samp","strong","kbd","var","map","area","figure","figcaption","a","img","button","progress","address","base","canvas","embed","audio","video","source","progress","svg","altglyph","altglyphdef","altglyphitem","animate","animatecolor","animatemotion","animatetransform","circle","clippath","color_profile","cursor","defs","desc","ellipse","feblend","fecolormatrix","fecomponenttransfer","fecomposite","feconvolvematrix","fediffuselighting","fedisplacementmap","fedistantlight","feflood","fefunca","fefuncb","fefuncg","fefuncr","fegaussianblur","feimage","femerge","femergenode","femorphology","feoffset","fepointlight","fespecularlighting","fespotlight","fetile","feturbulence","filter","font","font_face","font_face_format","font_face_name","font_face_src","font_face_uri","foreignobject","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","missing_glyph","mpath","path","pattern","polygon","polyline","radialgradient","rect","script","set","stop","style","switch","symbol","text","textpath","tref","tspan","use","view","vkern"];var _ns="";for(var i=0;i<__tags.length;i++){var tag=__tags[i];if(tag=="svg")_ns=",'http://www.w3.org/2000/svg'";eval(["window.$",tag,"=",tag.toUpperCase(),"= function(args,target){ return $e('",tag,"', args,target",_ns,"); };"].join(""))}var $sel=function(e,t,n){if(!window._sel_handler)window._sel_handler=function(e){e=e||window.event;var t=e.target||e.srcElement,n=t.tagName.toUpperCase()=="LI"?t:t.parentNode;t=n.childNodes[0];var r=n.name,i=$id(r+"-input"),s=n.attr("value"),o=1==n.attr("multiple");if(o){if(n.className.match(/\son$/)){n.className=n.className.replace(/\son$/g,"");t.className=t.className.replace(/\son$/g,"")}else{n.className+=" on";t.className+=" on"}var u=[];$("#"+r+"-list .on",function(e){if(e.tagName.toUpperCase()=="LI")u.push(e.getAttribute("value"))});i.value=u.join(",")}else{if(s==i.value){i.value=""}else{$("#"+r+"-list .on",function(e){e.className=e.className.replace(/\son$/,"")});n.className+=" on";n.childNodes[0].className+=" on";i.value=s}}};var r=t.value&&t.multiple?"#"+t.value.split(",").join("#,#")+"#":t.value||"",i=1==t.multiple||true==t.multiple,s=$div({id:t.id},n),o=$ul({id:t.id+"-list"},s),u=0,a=t.drawOption;for(var f in e){var l=i?r.indexOf("#"+f+"#")>=0?" on":"":t.value==f?" on":"";var c=t.noLabel==true?{className:t.labelClass?t.labelClass+l:l,html:"&nbsp;"}:{className:t.labelClass?t.labelClass+l:l,html:e[f]};var h=$li([$div(c)],o).attr({name:t.id,value:f,idx:u,multiple:i?1:0,className:t.optionClass?t.optionClass+l:l}).bind("click",window._sel_handler);if(a)a(h,u);u++}$input({name:t.name,id:t.id+"-input",className:t.formId?"form-item-"+t.formId:"",type:"hidden",value:t.value?t.value:""},s);return s};var $radio=function(e,t,n){delete t["multiple"];return $sel(e,t,n)};var $checkbox=function(e,t,n){t["multiple"]=1;return $sel(e,t,n)};var $select=function(e,t,n){if($browser.name=="MSIE"&&$browser.version<9&&t.name){var r=document.createElement(["<select name=",t.name,"></select>"].join("'"));r.attr(t);if(n)n.appendChild(r)}else{r=$e("select",t,n)}if($.isArray(e)){for(var i in e)$e("option",{value:e[i],html:e[i]},r)}else{for(var s in e)$e("option",{value:s,html:e[s]},r)}if(t.value)r.value=t.value;return r};var $rules=function(e,t){t=t||document.body;var n="runtime_rule_"+ ++__runtimeIdx,r=$e("style",{type:"text/css",id:n},t);var i=document.createTextNode("");for(var s in e){var o=typeof e[s]=="string"?e[s]:$.serialize(e[s],";",":");i.appendData([s,"{",o,"}\n"].join(""))}r.appendChild(i);return n};var $slider=function(e,t){e=e||{};e=$.extend({min:1,max:100,type:"range"},e);var n=$input(e);var r=$div({className:"slider"},t).css({overflow:"hidden"});if(e.minLabel){$label({html:e.min,"class":"min-label"},r)}if(e.maxLabel){n.bind("change",function(e){e=e||window.event;var t=e.srcElement||e.target,n=t.value;while(t.tagName.toUpperCase()!="LABEL")t=t.nextSibling;t.innerHTML=n});r.appendChild(n);$label({html:e.value,"class":"max-label"},r)}else{r.appendChild(n)}return r};var $autocomplete=function(e,t,n){t=t||{};e=e||[];if(!t.id)t.id="ac-"+ ++__runtimeIdx;t=$.extend({list:"datalist-"+t.id},t);var r=$input(t,n);if($browser.name.toLowerCase()=="safari"){$.include("liber.safari",$_autocomplete,{input:r,datas:e})}else{var i=$e("datalist",{id:"datalist-"+t.id},n);e.forEach(function(e,t){$e("option",{value:e},i)})}return r};var $ui={hide:function(e){if(!e)return;if(typeof e=="object"&&e.style){e.style.display="none";return}e=typeof e=="string"?[e]:e;for(var t in e){var n=$id(e[t]);if(n)n.style.display="none"}},show:function(e){if(!e)return;if(typeof e=="object"&&e.style){if(e.className)e.className=e.className.replace("hidden","");e.style.display="block";return}e=typeof e=="string"?[e]:e;for(var t in e){var n=$id(e[t]);if(n)n.style.display="block"}},toggle:function(e){if(!e)return;if(typeof e=="object"&&e.style){e.style.display=e.style.display=="none"?"block":"none";return}e=typeof e=="string"?[e]:e;for(var t in e){var n=$id(e[t]);if(n){if(n.className.indexOf("hidden")>=0){n.className=n.className.replace("hidden","")}else{n.style.display=n.style.display=="none"?"block":"none"}}}},remove:function(e){if(!e)return;var t=typeof e;if(t=="function")return;if(t=="string")e=$id(e);if(e&&e.parentNode)e.parentNode.removeChild(e)},insertBefore:function(e,t){e=$.isElement(e)?e:$id(e);t=$.isElement(t)?t:$id(t);t.parentNode.insertBefore(e,t)},insertAfter:function(e,t){e=$.isElement(e)?e:$id(e);t=$.isElement(t)?t:$id(t);t.parentNode.insertBefore(e,t.nextSibling)},unselectable:function(e){e.attr({unselectable:"on"}).bind("selectstart",function(e){return preventDefault(e)}).css({"-moz-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none"})},documentHeight:function(){var e=document.documentElement?document.documentElement:document.body;return Math.max(e.scrollHeight,e.offsetHeight,e.clientHeight)},screenWidth:function(){return window.innerWidth||document.documentElement.clientWidth||document.getElementsByTagName("body")[0].clientWidth},screenHeight:function(){return window.innerHeight||document.documentElement.clientHeight||document.getElementsByTagName("body")[0].clientHeight},rect:function(e){var t=document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop,n=document.documentElement&&document.documentElement.scrollLeft||document.body.scrollLeft;if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return{top:r.top+t,width:r.width,left:r.left+n,height:r.height}}var i=0,s=0,o=$ui.width(e),u=$ui.height(e);while(e&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop)){i+=e.offsetLeft-e.scrollLeft;s+=e.offsetTop-e.scrollTop;e=e.offsetParent}return{top:s+t,left:i+n,width:o,height:u}},height:function(e){return e?Math.max(e.clientHeight||0,e.scrollHeight||0,e.offsetHeight||0):0},width:function(e){return e?Math.max(e.clientWidth||0,e.scrollWidth||0,e.offsetWidth||0):0},cursor:function(e,t){$ui.mouseX=0;$ui.mouseY=0;if(e.pageX||e.pageY){$ui.mouseX=e.pageX;$ui.mouseY=e.pageY}else{$ui.mouseX=e.clientX+document.body.scrollLeft;$ui.mouseY=e.clientY+document.body.scrollTop}return{x:$ui.mouseX,y:$ui.mouseY}},inRect:function(e,t){return e.x>=t.left&&e.x<=t.left+t.width&&e.y>=t.top&&e.y<=t.top+t.height},title:function(e){if(e)document.title=e;return document.title},addLayer:function(e,t,n){if(!n){for(var r in __layers){$ui.hide(__layers[r])}}var i=document.createElement("div");i.id="layer_"+__layerIDX;i.setAttribute("layer",__layerIDX);i.className="layer";i.style.height=$ui.documentHeight();__layers.push(i);__layerIDX++;document.body.appendChild(i);i.css({width:"100%",height:"100%",zIndex:100+__layerIDX,position:"absolute",top:"0px",left:"0px",right:"0px",bottom:"0px",margin:"0px",border:"0px",padding:"0px",textAlign:"center"});if(e){e(i,t)}},removeLayer:function(e){var t=null;if(e){t=e.layer;if(!t)return;while(__layers.length>0){var n=__layers.pop();if(n.id==t.id){t.parentNode.removeChild(t);break}else if("message"==n.attr("layer-type")){n.parentNode.removeChild(n)}}}else{t=__layers.pop();if(t){t.parentNode.removeChild(t)}}$ui.showLastLayer()},showLastLayer:function(){var e=__layers.length;if(e>0){var t=__layers[e-1];if("message"==t.attr("layer-type")){__layers.pop();return $ui.showLastLayer()}if($id(t.id,true)){$ui.show(t);$this=window[t.attr("view")]}else{__layers.pop();return $ui.showLastLayer()}}else{if($conf.default_view){$app.loadView($conf.default_view)}else{window.location=window.location}}},bringLayerToFront:function(e){var t=[];for(var n in __layers){var r=__layers[n];if(r.attr("layer")!=e.attr("layer")){t.push(r)}}t.push(e);e.id="layer_"+__layerIDX;e.setAttribute("layer",__layerIDX);e.style.display="block";e.style.zIndex=100+__layerIDX;__layerIDX++;__layers=t},popup:function(e,t){t=t||{};$ui.addLayer(function(t,n){t.attr("layer-type","message");t.className="layer-popup";var r=$id("popup");var i=240||n.top;var s=600||n.width;t.style.top="0px";t.style.height=Math.max($ui.screenHeight(),$ui.height(document.body))+"px";if(!r)r=$div(e,t).attr({id:"popup","class":n.style||""}).css({top:i+"px",position:"fixed",width:s+"px",left:"50%",marginLeft:"-"+s/2+"px",overflow:"hidden"});var o=n.onDraw;if(o&&typeof o=="function")o(r,n);else{var u=parseInt(o);if(u>0){$.setTimeout($ui.popupClose,u)}}},t,true)},popupClose:function(e){var t=$id("popup");if(t){if(t.parentNode.getAttribute("layer")){$ui.removeLayer()}else $ui.remove(t)}},uploadWindow:function(e,t){var n="__tmpFileForm",r="__tmpFileBtn";var i=$id(n,true);if(i==undefined){i=$form({id:n,enctype:"multipart/form-data"},document.body).css({border:"0px",height:"0px",width:"0px",display:"none"});var s={id:r,type:"file",name:"tempfile"};if(t)s["multiple"]="multiple";var o=$input(s,i);o.bind("change",e);$.fire(o,"click")}else{i.style.display="block";$.fire(r,"click");$.setTimeout(function(){$id(n,true).style.display="none"},100)}}};var $http={getRequest:function(){return window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},ajax:function(e,t,n,r,i,s){t=$conf.http_host&&t.indexOf("http")!=0?$conf.http_host+t:t;var o=$http.getRequest();if(!i)i="json";o.runtimeParams={callback:r,format:i};if(s)o.runtimeParams.onprogress=s;var u=false;if(e=="UPLOAD"){e="POST";u=true;o.upload.addEventListener("progress",function(e){var t=parseInt(100-e.loaded/e.total*100);if(o.runtimeParams.onprogress)o.runtimeParams.onprogress(t)},false)}o.onreadystatechange=function(){if(o.readyState==4){if(o.status==200){if(o.runtimeParams.callback){var e=o.responseText;if(o.runtimeParams.format=="json"){try{e=JSON.parse(e)}catch(t){return o.runtimeParams.callback(null,{message:"json_error",data:e})}}o.runtimeParams.callback(e)}}else{var n={code:o.status,message:o.getResponseHeader("ERROR_MESSAGE")};if(o.runtimeParams.callback)o.runtimeParams.callback(null,n)}}};var a="";if(n){var f=[];for(var l in n){var c=n[l]+"";l=encodeURIComponent(l);c=!u?encodeURIComponent(c):c;f.push(l+"="+c)}a=f.join("&");if(e=="GET"){var h=t.indexOf("?")>0?"&":"?";t+=h+a}}e=e.toUpperCase();o.open(e,t,true);if(e=="POST"||e=="PUT"||e=="DELETE"){o.setRequestHeader("Content-type","application/x-www-form-urlencoded");o.send(a)}else o.send()},get:function(e,t,n,r){$http.ajax("GET",e,t,n,r)},post:function(e,t,n,r){$http.ajax("POST",e,t,n,r)},put:function(e,t,n,r){$http.ajax("PUT",e,t,n,r)},del:function(e,t,n,r){$http.ajax("DELETE",e,t,n,r)},upload:function(e,t,n,r,i){$http.ajax("UPLOAD",e,t,n,r,i)}}
