/**
 * @author soyoes 
 * @Copywrite (c) 2013, Liberhood, http://liberhood.com 
 * @URL : https://github.com/soyoes/liberjs
 * @license : MIT License
 */

function $(e,t,n){res=[];if(!n&&e.indexOf(" ")<0){if(e.charAt(0)=="#")return document.getElementById(e.replace("#",""));if(e.charAt(0)=="."&&document.getElementsByClassName)res=document.getElementsByClassName(e.replace(".",""));if(/^[a-zA-Z]+$/.test(e))res=document.getElementsByTagName(e)}else{e=n?"#layer_"+window._layerIDX+" "+e:e;qs=e.trim().split(" ");lastq=qs[qs.length-1];res=document.querySelectorAll(e);if(lastq.charAt(0)=="#")return res[0]}if(t){for(i in res){dm=res[i];type=typeof dm;if(type!="string"&&type!="function"&&type!="number"){t(dm)}}}return res}function $id(e){return document.getElementById(e)}window._params=undefined;var __packages="";var $this;var $conf=$conf||{};var $browser=function(){var e=navigator.appName,t=navigator.userAgent,n;var r=t.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);if(r&&(n=t.match(/version\/([\.\d]+)/i))!=null)r[2]=n[1];r=r?[r[1],r[2]]:[e,navigator.appVersion,0];return{name:r[0],version:parseInt(r[1])}}();var $app={_view:undefined,layers:[],start:function(e){__default={modules:[],liber_path:"/js/"};$app.start_view=e;for(i in __default){if(!$conf[i])$conf[i]=__default[i]}if($conf.modules)for(i in $conf.modules){$utils.include($conf.modules[i])}if($app.onload)$app.onload();else{$app.loaded()}},loaded:function(){if(typeof $app.start_view=="string")$app.loadView($app.start_view);else $app.loadView()},handle:function(e,t){switch(e){case"loaded":$app.drawView();break;case"redirect":$app.loadView(t);break;default:break}},trans:function(e){e=e||window.event;target=e.target||e.srcElement;if(target){url=target.getAttribute("url");if(url){$app.loadView(url)}}},loadView:function(e){e=e||$conf.default_view;if(e){if(e.indexOf("http:")==0||e.indexOf("https:")==0){location.href=e;return}else{params=$utils.unpackParams(e);viewname=e.split("?")[0];$app.view=viewname;view=$controller.enhance(window[viewname]);if(!view){throw new Error("100 : "+viewname+" does not exist");return}$this=view;view.params=params;if(view.onload){view.onload(params)}else{view.loaded()}}}},drawView:function(e){e=e||$app.view;e=typeof e=="string"?window[e]:e;if(!e){$app.closeView($app.view);return}if(e.reusable&&e.layer){$ui.bringLayerToFront(e.layer);if(e.drawContent){e.drawContent(e.wrapper,e.layer)}return}$ui.addLayer(function(e,t){e.attr("view",t.name);$ui._view=t;if(!t.noHeader){var n=$app.drawHeader?$app.drawHeader(e):$div({id:"header"},e);if(t.drawHeader)t.drawHeader(n)}var r=$div({id:"content"},e);var i=$div({"class":"wrapper",id:"wrapper",layer:e.attr("layer")},r);if(t.drawContent){if(t.layer)$ui.remove(t.layer);t.layer=e;t.wrapper=i;t.drawContent(i,e)}if(!t.noFooter){var s=$app.drawFooter?$app.drawFooter(e):$div({id:"footer"},e);if(t.drawFooter)t.drawFooter(s)}},e)},closeView:function(e){e=e||$this;if(typeof e=="string")e=window[e];if(!e)return;$this=$app.view=undefined;if(e.onclose)e.onclose();$ui.removeLayer(e)}};var $controller={loaded:function(){$app.handle("loaded")},close:function(){$app.closeView($this)},redirect:function(e){$app.handle("redirect",e)},enhance:function(e){if(!e){throw new Error("101 :now view to enhance");return}if(!e.__enhanced){$utils.extend(e,$controller);delete e["enhance"];e.__enhanced=true}return e}};var $history={stack:[],change:function(e){anc=history.state||location.hash;console.log("history.change",anc);if(!anc||anc==""){window.location=window.location}else{if($history.stack.length>0){last=$history.stack.length>1?$history.stack[$history.stack.length-2]:null;console.log("last",last);if(last&&last==anc){$history.stack.pop();$history.stack.pop();console.log("remove layer");window._layers.pop();$ui.removeLayer()}else{if($history.stack[$history.stack.length-1]!=anc)$history.stack.push(anc)}}else{$history.stack.push(anc)}}},push:function(e){if(typeof e!="string"&&e.attr){href=e.attr("href");if(href)e=href;else return}if(e!="#"){if(history.pushState){history.pushState({},e,e)}else{lk=$a({href:e},document.body);$utils.fire(lk,"click")}$history.stack.push(e)}},init:function(){if(window.onpopstate){window.onpopstate=$history.change}else{window.onhashchange=$history.change}}};$history.init();Date.prototype.customFormat=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E;var S=this;n=((t=S.getFullYear())+"").slice(-2);s=(o=S.getMonth()+1)<10?"0"+o:o;i=(r=["January","February","March","April","May","June","July","August","September","October","November","December"][o-1]).substring(0,3);f=(l=S.getDate())<10?"0"+l:l;a=(u=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][S.getDay()]).substring(0,3);E=l>=10&&l<=20?"th":(w=l%10)==1?"st":w==2?"nd":w==3?"rd":"th";e=e.replace("#YYYY#",t).replace("#YY#",n).replace("#MMMM#",r).replace("#MMM#",i).replace("#MM#",s).replace("#M#",o).replace("#DDDD#",u).replace("#DDD#",a).replace("#DD#",f).replace("#D#",l).replace("#th#",E);p=c=S.getHours();if(p==0)p=24;if(p>12)p-=12;h=p<10?"0"+p:p;b=(y=c<12?"am":"pm").toUpperCase();d=(v=S.getMinutes())<10?"0"+v:v;m=(g=S.getSeconds())<10?"0"+g:g;return e.replace("#hhh#",c).replace("#hh#",h).replace("#h#",p).replace("#mm#",d).replace("#m#",v).replace("#ss#",m).replace("#s#",g).replace("#ampm#",y).replace("#AMPM#",b)};String.prototype.validate=function(e){parts=[];if(e.indexOf("len:")==0||e.indexOf("id:")==0){parts=e.split(":");e=parts[0]}switch(e){case"email":return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(.+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(this);case"phone":return/^[a-zA-Z0-9\-().\s]{8,15}$/.test(this);case"zip_code":return/^\d{5}(-\d{4})?$/.test(this);case"address":return/^[a-z0-9\s,\.'-]*$/i.test(this);case"url":re=new RegExp("^((http|https|ftp)://)*([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&%$-]+)*@)*((25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]).(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0).(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0).(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])|([a-zA-Z0-9-]+.)*[a-zA-Z0-9-]+.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(:[0-9]+)*(/($|[a-zA-Z0-9.,?'\\+&%$#=~_-]+))*$");return re.test(this);case"len":min=parseInt(parts[1]);max=parts.length==3?parseInt(parts[2]):0;return max>0?this.length>=min&&this.length<=max:this.length>=min;case"id":targetId=parts[1];return $id(targetId).value==this}return true};String.prototype.ucfirst=function(){return this.charAt(0).toUpperCase()+this.substring(1)};String.prototype.toHex=function(){var e=[],t=this.length;for(i=0;i<t;i+=1){c=this.charCodeAt(i);e.push(c.toString(16))}return e.join("")};String.prototype.getByte=function(){count=0;for(i=0;i<this.length;i++){n=escape(this.charAt(i));if(n.length<4)count++;else count+=2}return count};String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.CJKLength=function(){len=0;str=escape(this);for(i=0;i<str.length;i++,len++){if(str.charAt(i)=="%"){if(str.charAt(++i)=="u"){i+=3;len++}i++}}return len};String.prototype.screenSize=function(e,t,n){text=this;rowSpliter="\n";di=document.createElement("input");di.id="dummy_text_size_calculator";style={border:0,margin:0,outer:0,padding:0,color:"trasparent",backgroundColor:"trasparent",whiteSpace:"nowrap"};for(k in style)di.style[k]=style[k];if(e)di.style.fontFamily=e;if(t)di.style.fontSize=t;lines=text.split(rowSpliter);longestRow="";rowCols=[];for(r in lines){row=lines[r];if(row.length>longestRow.CJKLength())longestRow=row;rowCols.push(row.length)}di.value=longestRow;di.size=longestRow.CJKLength();document.body.appendChild(di);size={width:di.clientWidth+di.size,height:(di.clientHeight+1)*lines.length};di.parentNode.removeChild(di);if(n&&size.width>n){charW=size.width/longestRow.length;maxChars=Math.floor(n/charW);size.width=n;orgRows=lines.length;rowH=size.height/orgRows;for(i=0;i<rowCols.length;i++){chars=rowCols[i];if(chars>maxChars)orgRows+=Math.ceil(chars*charW/n)-1}size.height=orgRows*rowH}console.log(text+"-"+t+":"+size.width+","+size.height);return size};var $utils={_params:function(){if(_params)return _params;scripts=document.getElementsByTagName("script");_params={};for(i in scripts){sc=scripts[i];if(sc.src.indexOf("liber.js")>=0){pstrs=sc.src.split("liber.js");pstr=pstrs[1];if(pstr.indexOf("?")==0){pstr=pstr.replace("?","");pstrs=pstr.split("&");for(j in pstrs){parts=pstrs[j].split("=");_params[parts[0]]=parts[1]}}return _params}}},inArray:function(e,t,n){var r="",i=!!n;if(i){for(r in t){if(t[r]===e)return true}}else{for(r in t){if(t[r]==e)return true}}return false},empty:function(e){var t,n,r,i;var s=[t,null,false,0,"","0"];for(r=0,i=s.length;r<i;r++){if(e===s[r])return true}if(typeof e==="object"){for(n in e){return false}return true}return false},clone:function(e){if(typeof e=="object"){o={};for(i in e){o[i]=e}return o}return e},getCookie:function(e){if(document.cookie){kvs=$utils.unpackParams(document.cookie,";");return kvs[e]}return null},unpackParams:function(e,t){if(!e)return null;if(!t)t="&";e=e.replace(/(.*)\?/i,"");parts=e.split(t);params={};for(i in parts){ps=parts[i].split("=");if(ps.length==2)params[ps[0].trim()]=ps[1]}return params},packParams:function(e,t){var n=[];if(!t)t="&";for(prop in e){n.push([prop,e[prop]].join("="))}return n.join(t)},keyCode:function(e){if(document.all)return e.keyCode;else if($id)return e.keyCode?e.keyCode:e.charCode;else if(document.layers)return e.which},isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"},isElement:function(e){return typeof HTMLElement==="object"?e instanceof HTMLElement:e&&typeof e==="object"&&e.nodeType===1&&typeof e.nodeName==="string"},isFunction:function(e){var t={};return e&&t.toString.call(e)==="[object Function]"},isBool:function(e){return e===true||e===false},isElement:function(e){try{return e instanceof HTMLElement}catch(t){return typeof e==="object"&&e.nodeType===1&&typeof e.style==="object"&&typeof e.ownerDocument==="object"}},include_old:function(e,t,n){var r,i=document.getElementsByTagName("script")[0];if(n){tag=$id(t);if(tag)$ui.remove(tag)}if(!$id(t)){r=document.createElement("script");if(t)r.id=t;r.src=e;i.parentNode.insertBefore(r,i);$utils.__includeInterval=setInterval()}},include:function(e,t,n){if(e.indexOf(".js")<0)e+=".js";if(e.indexOf("/")<0)e=$conf.liber_path+e;var r=e.split("/");r=r[r.length-1].replace(/\./g,"_");var i=r.replace("_js","");if(!$id(r)){se=document.createElement("script");se.id=r;se.src=e;document.head.appendChild(se);if(!$utils.__include)$utils.__include={};$utils.__include[r]={interval:setInterval(function(){if($utils.included(i)){clearInterval($utils.__include[r].interval);if($utils.__include[r].callback){cb=$utils.__include[r].callback;if(typeof cb=="function")cb($utils.__include[r].params);else if(typeof cb=="string"){cb=window[cb];if(cb)cb($utils.__include[r].params)}}console.log("Included-times",$utils.__include[r].times+1);delete $utils.__include[r]}else{$utils.__include[r].times=$utils.__include[r].times+1;if($utils.__include[r].times>50){clearInterval($utils.__include[r].interval);delete $utils.__include[r];console.log("Include timeover")}}},10),callback:t,times:0,params:n}}else{if(t){if(typeof t=="function")t(n);else if(typeof t=="string"){t=window[t];if(t)t(n)}}}},setTimeout:function(e,t,n){if($browser.name=="Firefox"){var r=e;setTimeout(r,t,n)}else if($browser.name=="MSIE"){setTimeout(function(t){return function(){e(t)}}(n),t)}else setTimeout(e,t,n)},archivePath:function(e,t){res=parseInt(e)%parseInt(t);return[res,e].join("/")},extend:function(e,t){for(var n in t)e[n]=t[n];return e},_eventMatchers:{HTMLEvents:/^(?:load|unload|abort|error|select|change|submit|reset|focus|blur|resize|scroll)$/,MouseEvents:/^(?:click|dblclick|mouse(?:down|up|over|move|out))$/},_eventDefaultOptions:{pointerX:0,pointerY:0,button:0,ctrlKey:false,altKey:false,shiftKey:false,metaKey:false,bubbles:true,cancelable:true},fire:function(e,t){e=typeof e=="string"?$id(e):e;if(e==undefined)return;var n=$utils.extend($utils._eventDefaultOptions,arguments[2]||{});var r,i=null;for(var s in $utils._eventMatchers){if($utils._eventMatchers[s].test(t)){i=s;break}}if(!i)throw new SyntaxError("Only HTMLEvents and MouseEvents interfaces are supported");if(e[t]){e[t]()}else if(document.createEvent){r=document.createEvent(i);if(i=="HTMLEvents"){r.initEvent(t,n.bubbles,n.cancelable)}else{r.initMouseEvent(t,n.bubbles,n.cancelable,document.defaultView,n.button,n.pointerX,n.pointerY,n.pointerX,n.pointerY,n.ctrlKey,n.altKey,n.shiftKey,n.metaKey,n.button,e)}e.dispatchEvent(r)}else{n.clientX=n.pointerX;n.clientY=n.pointerY;var o=document.createEventObject();r=$utils.extend(o,n);e.fireEvent("on"+t,r)}return e},log:function(e){e=_viewer_id?[_viewer_id,e].join(":"):"0:"+e;if($http)$http.get(["/log.php?action=",e].join(""))},screenWidth:function(){xWidth=null;if(window.screen!=null)xWidth=window.screen.availWidth;if(window.innerWidth!=null)xWidth=window.innerWidth;if(document.body!=null)xWidth=document.body.clientWidth;return xWidth},screenHeight:function(){xHeight=null;if(window.screen!=null)xHeight=window.screen.availHeight;if(window.innerHeight!=null)xHeight=window.innerHeight;if(document.body!=null)xHeight=document.body.clientHeight;return xHeight},rand:function(e,t){var n=arguments.length;if(n===0){e=0;t=2147483647}else if(n===1){t=e;e=1}return Math.floor(Math.random()*(t-e+1))+e},"package":function(e){__packages=__packages.split(",");__packages.push(e.replace(/_/g,"."));__packages=__packages.join(",")},included:function(e){return __packages.indexOf(e.replace(/_/g,"."))>=0}};var $deltas={linear:function(e){return e},quad:function(e){return Math.pow(e,2)},quad5:function(e){return Math.pow(e,5)},circ:function(e){return 1-Math.sin(Math.acos(e))},back:function(e,t){t=t||1.5;return Math.pow(e,2)*((t+1)*e-t)},bounce:function(e){for(var t=0,n=1,r;1;t+=n,n/=2){if(e>=(7-4*t)/11){return-Math.pow((11-6*t-11*e)/4,2)+Math.pow(n,2)}}},elastic:function(e,t){t=t||.1;return Math.pow(2,10*(e-1))*Math.cos(20*Math.PI*t/3*e)},easeOut:function(e){if(typeof e=="string")e=$deltas[e];return function(t){return 1-e(1-t)}},easeInOut:function(e){if(typeof e=="string")e=$deltas[e];return function(t){if(t<=.5){return e(2*t)/2}else{return(2-e(2*(1-t)))/2}}}};var __element={addClass:function(e){if(this.className.indexOf(e)<0){this.className+=" "+e}return this},removeClass:function(e){if(!e)return this;e=e.trim();if(this.className.indexOf(e)>=0){clss=this.className.split(" ");var t=[];for(i in clss){c=clss[i].trim();if(c!=e&&c.length>0)t.push(c)}this.className=t.join(" ")}return this},css:function(e,t){if(typeof e=="string"){if(t!=undefined){if(e.indexOf("background")>=0&&t.indexOf("url(")>=0&&$conf.image_path&&t.indexOf("data:image")<0){t=t.replace("url(","url("+$conf.image_path)}this.style[e]=t}else return this.style[e]}else if(typeof e=="object"&&!t){for(f in e){this.css(f,e[f])}}return this},attr:function(e,t){if(typeof e=="string"){if(e=="html")e="innerHTML";if(e=="class")e="className";if(t!=undefined){if(this.tagName=="IMG"&&e.toLowerCase()=="src"){this[e]=$conf.image_path&&t.indexOf("data:image")<0?$conf.image_path+t:t}else{this[e]=t}if(typeof t!="function"&&!$utils.isBool(t)){if(this.tagName=="INPUT"){if($browser.name=="MSIE"&&$browser.version<9&&(e=="type"||e=="name"))return this;if($browser.name=="MSIE"&&$browser.version<10&&e=="placeHolder"){this.setAttribute(e,t);if(!this.value||this.value==""){this.value=t;this.style.color="#999";this.attachEvent("onfocus",function(e){e=e||window.event;ipt=event.srcElement;ipt.style.color="#333";if(ipt.value==ipt.attr("placeHolder")){ipt.value=""}});this.attachEvent("onblur",function(e){e=e||window.event;ipt=event.srcElement;if(ipt.value==""||ipt.value==ipt.attr("placeHolder")){ipt.value=ipt.attr("placeHolder");ipt.style.color="#999"}else{ipt.style.color="#333"}})}}}if(e!="innerHTML"&&e!="className")this.setAttribute(e,t)}}else{return this.getAttribute(e)}}else if(typeof e=="object"&&!t){for(_f in e){if(typeof e[_f]=="function"){this.bind(_f,e[_f])}else{this.attr(_f,e[_f])}}}return this},bind:function(e,t){if(typeof e=="string"){if(t){e=e.replace(/^on/,"");if(this.addEventListener)this.addEventListener(e,t,false);else if(this.attachEvent){if(typeof t=="function")this.attachEvent("on"+e,t);else if(typeof t=="string")this.setAttribute("on"+e,t)}else{this["on"+e]=t}}}else if(typeof e=="object"&&!t){for(f in e){f=f.replace(/^on/,"");if(this.addEventListener)this.addEventListener(f,e[f],false);else if(this.attachEvent){this.attachEvent("on"+f,e[f]);if(typeof e[f]=="function")this.attachEvent("on"+f,e[f]);else if(typeof e[f]=="string")this.setAttribute("on"+f,e[f])}else{this["on"+f]=e[f]}}}return this},height:function(){el=this;return Math.max(el.clientHeight||0,el.scrollHeight||0,el.offsetHeight||0)},width:function(e){e=this;return Math.max(e.clientWidth||0,e.scrollWidth||0,e.offsetWidth||0)},hide:function(){$ui.hide(this);return this},show:function(){$ui.show(this);return this},animate:function(e){var t=this;if(e.delay){delay=parseInt(e.delay);delete e["delay"];$utils.setTimeout(function(e){if(e.ele)e.ele.animate(e.opts)},delay,{ele:t,opts:e});return t}var n=new Date;e.duration=e.duration||1e3;e.frame=e.frame||50;e.interval=1e3/e.frame;e.delta=e.delta||"linear";var r=setInterval(function(){var i=new Date-n;var s=i/e.duration;if(s>1)s=1;delta=$deltas[e.delta];if(e.style){if(e.style=="easeOut")delta=$deltas.easeOut(delta);if(e.style=="easeInOut")delta=$deltas.easeInOut(delta)}var o=delta(s);e.step(t,o);if(s==1){clearInterval(r)}},e.interval);return this}};if($browser.name=="MSIE"&&$browser.version<9){$utils.include("liber.ie8","ie8_enhance")}else{$utils.extend(Element.prototype,__element)}var $e=function(e,t,n){_el=document.createElement(e);if(n&&typeof n=="string")n=$id(n);if(t){dataType=typeof t;if(dataType=="string"){switch(e){case"img":_el.src=$conf.image_path&&t.indexOf("data:image")<0?$conf.image_path+t:t;break;case"a":_el.href=t;break;default:_el.innerHTML=t;break}}else if($utils.isArray(t)){for(_argIdx in t){if(t[_argIdx]!=null){if($utils.isElement(t[_argIdx])){_el.appendChild(t[_argIdx])}else if($utils.isFunction(t[_argIdx])){var r=_el;res=t[_argIdx]();if($utils.isArray(res)){for(i in res){if($utils.isElement(res[i]))r.appendChild(res[i])}}else if($utils.isElement(res)){console.log(res,_el);r.appendChild(res)}_el=r}else{}}}}else if($utils.isElement(t)){_el.appendChild(t)}else if($utils.isFunction(t)){return $e(e,t(),n)}else if(dataType=="object"){for(_k in t){_v=t[_k];if(typeof _v=="function"){_el[_k]=_v}else{_el.attr(_k,_v)}}}}if(n&&typeof n!="function")n.appendChild(_el);return _el};var TAGS=["table","tr","th","td","div","img","ul","lo","li","p","a","b","strong","textarea","br","hr","form","input","span","label","h1","h2","h3"];for(i in TAGS){if(typeof TAGS[i]=="function")continue;eval(["var ",TAGS[i].toUpperCase(),"= function(args,target){ return $e('",TAGS[i],"', args,target); };"].join(""));eval(["var $",TAGS[i],"= function(args,target){ return $e('",TAGS[i],"', args,target); };"].join(""))}var $radio=function(e,t,n){opts=[];oncheck=function(e){e=e||window.event;n=e.target||e.srcElement;id=n.name.replace(/_options$/,"");ipt=$id(id);tv=n.attr("value");if(tv==ipt.value){ipt.value="";n.className="icons radio"}else{$("."+id+" .on",function(e){e.className="icons radio"});n.className="icons radio on";ipt.value=tv}};for(v in e){opt=$div({className:"radio-option "+t.id},n);ra=$span({className:"icons radio ",name:t.id+"_options",value:v,html:e[v],onclick:oncheck},opt);if(t.value==v){ra.className="icons radio on "}opts.push(opt)}opts.push($input({name:t.name,id:t.id,type:"hidden",className:t.className,value:t.value?t.value:""},n));return opts};window.RADIO=$checkbox;var _checkbox_handler=function(e){e=e||window.event;target=e.target||e.srcElement;id=target.name.replace(/_options$/,"");ipt=$id(id);vs=[];target.className=target.className.indexOf("check on")>0?"icons check":"icons check on";$("."+id+" .on",function(e){vs.push(e.getAttribute("value"))});ipt.value=vs.join(",")};var $checkbox=function(e,t,n){opts=[];valuestr=t.value?"#"+t.value.split(",").join("#,#")+"#":"";for(v in e){opt=$div({className:"check-option "+t.id},n);chk=$span({className:"icons check "+t.id+"_options",name:t.id+"_options",value:v,html:e[v]},opt);if(!t.onchange){chk.bind("click",_checkbox_handler)}else{chk.onchange=t.onchange}if(valuestr.indexOf("#"+v+"#")>=0){chk.className="icons check on "}opts.push(opt)}opts.push($input({name:t.name,id:t.id,type:"hidden",className:t.className,value:t.value?t.value:""},n));return opts};window.CHECKBOX=$checkbox;var $select=function(e,t,n){if($browser.name=="MSIE"&&$browser.version<9&&t.name){sele=document.createElement(["<select name=",t.name,"></select>"].join("'"));sele.attr(t);if(n)n.appendChild(sele)}else{sele=$e("select",t,n)}if($utils.isArray(e)){for(i in e){$e("option",{value:e[i],html:e[i]},sele)}}else{for(v in e){$e("option",{value:v,html:e[v]},sele)}}if(t.value)sele.value=t.value;return sele};window.SELECT=$select;window._layerIDX=0;window._layers=[];var $msg={messages:{},register:function(e,t,n,r){$msg.messages[e]={};$msg.messages[e][t]={params:r,func:n}},call:function(e,t,n){if($msg.messages[e][t]){m=$msg.messages[e][t];params=m.params;if(!params)params={};if(n)for(k in n){params[k]=n[k]}m.func(params)}},trigger:function(e){e=e||window.event;if(e&&(e.target||e.srcElement)){target=e.target||e.srcElement;$msg.call(target.id,e.type)}}};var UIKits=function(){var e=this;this.hide=function(e){if(!e)return;if(typeof e=="object"&&e.style){e.style.display="none";return}e=typeof e=="string"?[e]:e;for(i in e){d=$id(e[i]);if(d)d.style.display="none"}};this.show=function(e){if(!e)return;if(typeof e=="object"&&e.style){if(e.className)e.className=e.className.replace("hidden","");e.style.display="block";return}e=typeof e=="string"?[e]:e;for(i in e){d=$id(e[i]);if(d)d.style.display="block"}};this.toggle=function(e){if(!e)return;if(typeof e=="object"&&e.style){e.style.display=e.style.display=="none"?"block":"none";return}e=typeof e=="string"?[e]:e;for(i in e){if(d=$id(e[i])){if(d.className.indexOf("hidden")>=0){d.className=d.className.replace("hidden","")}else{d.style.display=d.style.display=="none"?"block":"none"}}}};this.remove=function(e){if(!e)return;type=typeof e;if(type=="function")return;if(type=="string")e=$id(e);if(e&&e.parentNode)e.parentNode.removeChild(e)};this.documentHeight=function(){var e=document.documentElement?document.documentElement:document.body;return Math.max(e.scrollHeight,e.offsetHeight,e.clientHeight)};this.preventDefault=function(e){e=e||window.event;if(e.preventDefault){e.preventDefault()}e.returnValue=false};this.addLayer=function(e,t,n){if(!n){for(i in window._layers){$ui.hide(window._layers[i])}}layer=document.createElement("div");layer.id="layer_"+window._layerIDX;layer.setAttribute("layer",window._layerIDX);layer.className="layer";layer.style.height=this.documentHeight();window._layers.push(layer);window._layerIDX++;document.body.appendChild(layer);layer.css({width:"100%",height:"100%",zIndex:100+window._layerIDX,position:"absolute",top:"0px",left:"0px",right:"0px",bottom:"0px",margin:"0px",border:"0px",padding:"0px",textAlign:"center"});if(e){e(layer,t)}};this.removeLayer=function(e){layer=null;if(e){layer=e.layer;if(!layer)return;while(window._layers.length>0){l=window._layers.pop();if(l.id==layer.id){layer.parentNode.removeChild(layer);break}else if("message"==l.attr("layer-type")){l.parentNode.removeChild(l)}}}else{layer=window._layers.pop();if(layer){layer.parentNode.removeChild(layer)}}this.showLastLayer()};this.showLastLayer=function(){len=window._layers.length;if(len>0){last=window._layers[len-1];if("message"==last.attr("layer-type")){window._layers.pop();return this.showLastLayer()}if($id(last.id))$ui.show(last);else{window._layers.pop();return $ui.showLastLayer()}}else{if($conf.default_view){$app.loadView($conf.default_view)}else{window.location=window.location}}};this.bringLayerToFront=function(e){layers=[];for(i in window._layers){l=window._layers[i];if(l.attr("layer")!=e.attr("layer")){layers.push(l)}}layers.push(e);e.id="layer_"+window._layerIDX;e.setAttribute("layer",window._layerIDX);e.style.display="block";e.style.zIndex=100+window._layerIDX;window._layerIDX++;window._layers=layers};this.showMessage=function(e,t,n){$ui.addLayer(function(n,r){n.attr("layer-type","message");n.className="layer-black";if(window.addEventListener){window.addEventListener("DOMMouseScroll",this.preventDefault,false)}window.onmousewheel=this.preventDefault;if(document.onmousewheel)document.onmousewheel=this.preventDefault;box=$id("messageBox");msgtop=240;n.style.top=document.body.scrollTop+"px";if(!box)box=$div({id:"messageBox",html:e},n).css("marginTop",msgtop+"px");if(t&&typeof t=="function")t(r,box);else{time=parseInt(t);if(time>0){$utils.setTimeout($ui.hideMessage,time)}}},n,true)};this.updateMessage=function(e,t,n){box=$id("messageBox");if(!box)return;if(n)box.innerHTML+=e;else box.innerHTML=e;if(t>0){$utils.setTimeout($ui.hideMessage,t)}};this.hideMessage=function(e){box=$id("messageBox");if(box){if(window.removeEventListener){window.removeEventListener("DOMMouseScroll",this.preventDefault,false)}window.onmousewheel=document.onmousewheel=null;if(box.parentNode.getAttribute("layer")){$ui.removeLayer()}else $ui.remove(box)}};this.showAlertWindow=function(e,t,n,r){$ui.showMessage(e,function(e,t){t.addClass("alert-window");bar=$div([$a({className:"button orange",html:"OK",data:e.data,onclick:e.ok}),$a({className:"button gray",html:"Cancel",onclick:function(t){$ui.hideMessage();if(e.cancel)e.cancel(t)}})],t).attr("class","button-bar buttons")},{ok:n,cancel:r,data:t})};this.countDown=function(t,n){if(t)$ui.counterDomId=t;if(n)$ui.counterCallback=n;setTimeout(function(){if($ui.counterDomId){dom=$id(e.counterDomId);counter=parseInt(dom.innerHTML)-1;dom.innerHTML=counter;if(counter>0){$ui.countDown()}else{if($ui.counterCallback)$ui.counterCallback();$ui.counterDomId=null;$ui.counterCallback=null}}},1e3)};this.formView=function(e){$utils.include("liber.ui.ext",function(e){try{form=new FormView(e);form.draw()}catch(t){}},e)};this.imageUploadWindow=function(e,t){var n=$id("tempImages");if(n==undefined){n=$form({id:"tempImages",enctype:"multipart/form-data"},document.body).css({border:"0px",height:"0px",width:"0px",display:"none"});params={id:"tempImage",type:"file",name:"tempImage"};if(t)params["multiple"]="multiple";ipt=$input(params,n);ipt.bind("change",e);$utils.fire(ipt,"click")}else{n.style.display="block";$utils.fire("tempImage","click");$utils.setTimeout(function(){$id("tempImages").style.display="none"},100)}};this._view=undefined;this.calendar=function(e,t,n){if(typeof e=="string")e=$id(e);if(!e)return;e.innerHTML="";dom="";if($ui._calendar){dom=$ui._calendar.dom;e.appendChild(dom)}else{var r=function(t){cal=new Calendar(t.attrs,t.onclick);cal.draw();$ui._calendar=cal;e.appendChild(cal.dom)};$utils.include("liber.ui.ext",r,{attrs:t,onclick:n})}}};var $ui=new UIKits;var HTTPKits=function(){this.getRequest=function(){return window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")};this.ajax=function(e,t,n,r,i,s){var o=this.getRequest();if(!i)i="json";o.runtimeParams={callback:r,format:i};if(s)o.runtimeParams.onprogress=s;isFile=false;if(e=="UPLOAD"){e="POST";isFile=true;o.upload.addEventListener("progress",function(e){var t=parseInt(100-e.loaded/e.total*100);if(o.runtimeParams.onprogress)o.runtimeParams.onprogress(t)},false)}o.onreadystatechange=function(){if(o.readyState==4){if(o.status==200){if(o.runtimeParams.callback){res=o.responseText;if(o.runtimeParams.format=="json"){res=JSON.parse(res)}o.runtimeParams.callback(res)}}else{errors={code:o.status,message:o.getResponseHeader("ERROR_MESSAGE")};o.runtimeParams.callback(null,errors)}}};var u="";if(n){datas=[];for(key in n){key=key.replace(/\//g,"%2F").replace(/\s/g,"%20");value=n[key]+"";value=!isFile?value.replace(/\//g,"%2F").replace(/\s/g,"%20"):value;datas.push(key+"="+value)}u=datas.join("&");if(e=="GET"){var a=t.indexOf("?")>0?"&":"?";t+=a+u}}e=e.toUpperCase();console.log("http send ",e,t,u);o.open(e,t,true);if(e=="POST"||e=="PUT"||e=="DELETE"){o.setRequestHeader("Content-type","application/x-www-form-urlencoded");o.send(u)}else o.send()};this.get=function(e,t,n,r){this.ajax("GET",e,t,n,r)};this.post=function(e,t,n,r){this.ajax("POST",e,t,n,r)};this.put=function(e,t,n,r){this.ajax("PUT",e,t,n,r)};this.del=function(e,t,n,r){this.ajax("DELETE",e,t,n,r)};this.upload=function(e,t,n,r,i){this.ajax("UPLOAD",e,t,n,i,r)}};var $http=new HTTPKits;var _viewer_id=$utils.getCookie("tid")